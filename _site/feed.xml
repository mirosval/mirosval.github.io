<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Mirosval</title>
        <description>Personal blog about programming and stuff</description>      
        <link>http://mirosval.github.io</link>
        <atom:link href="http://mirosval.github.io/feed.xml" rel="self" type="application/rss+xml" />
        
            <item>
                <title>Performance of the getOrientationAndMagnitude()</title>
                <description>&lt;p&gt;I normally don&amp;#8217;t do premature performance optimizations, and I was planning on optimizing the whole eye tracker later, when I felt I had all of the functionality I wanted, but from time to time, you still want to check your code, particularly when it&amp;#8217;s suspiciously slow. So I did examine the code I had written so far using &lt;a href=&#39;http://packages.python.org/line_profiler/&#39;&gt;line_profiler&lt;/a&gt; (Abysmal documentation btw.) like so:&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;bash&#39;&gt;kernprof.py -l test.py &lt;span class=&#39;o&#39;&gt;&amp;amp;&amp;amp;&lt;/span&gt; python -m line_profiler test.py.lprof
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I have found that the most time is being spent in one function, &lt;code&gt;getOrientationAndMagnitude&lt;/code&gt;, you&amp;#8217;ll recall it looked like this:&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;python&#39;&gt;&lt;span class=&#39;lineno&#39;&gt; 1&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;def&lt;/span&gt; &lt;span class=&#39;nf&#39;&gt;getOrientationAndMagnitude&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;image&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;show&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;bp&#39;&gt;False&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;):&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 2&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;sobelHorizontal&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;Sobel&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;image&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;CV_32F&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 3&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;sobelVertical&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;Sobel&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;image&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;CV_32F&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 4&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt; 5&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;h&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;sobelHorizontal&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 6&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;v&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;sobelVertical&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 7&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt; 8&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;orientation&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;np&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;empty&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;image&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;shape&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 9&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;magnitude&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;np&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;empty&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;image&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;shape&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;10&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;11&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;height&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;width&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;h&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;shape&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;12&lt;/span&gt;     &lt;span class=&#39;k&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;y&lt;/span&gt; &lt;span class=&#39;ow&#39;&gt;in&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;range&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;height&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;):&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;13&lt;/span&gt;         &lt;span class=&#39;k&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;x&lt;/span&gt; &lt;span class=&#39;ow&#39;&gt;in&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;range&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;width&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;):&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;14&lt;/span&gt;             &lt;span class=&#39;n&#39;&gt;orientation&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;y&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;][&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;fastAtan2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;h&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;y&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;][&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;v&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;y&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;][&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;15&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;16&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;magnitude&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;magnitude&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;h&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;v&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;17&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;18&lt;/span&gt;     &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;orientation&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;magnitude&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I wrote this code some time ago, when I was less familiar with OpenCV than I am now, and you can quickly see the hotspot. Yes, the line &lt;code&gt;14&lt;/code&gt;. I probably did it like this because I hadn&amp;#8217;t noticed the &lt;a href=&#39;http://docs.opencv.org/modules/core/doc/operations_on_arrays.html#phase&#39;&gt;&lt;code&gt;phase()&lt;/code&gt;&lt;/a&gt; function OpenCV has.&lt;/p&gt;

&lt;p&gt;But this will serve the purpose of showing how such a small oversight can have a dramatic effect on performance. Armed with the &lt;a href=&#39;http://docs.opencv.org/modules/core/doc/operations_on_arrays.html#phase&#39;&gt;&lt;code&gt;phase()&lt;/code&gt;&lt;/a&gt; function, we can do the following:&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;python&#39;&gt;&lt;span class=&#39;lineno&#39;&gt;1&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;def&lt;/span&gt; &lt;span class=&#39;nf&#39;&gt;getOrientationAndMagnitude&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;image&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;show&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;bp&#39;&gt;False&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;):&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;2&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;h&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;Sobel&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;image&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;CV_32F&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;3&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;v&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;Sobel&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;image&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;CV_32F&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;4&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;5&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;orientation&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;phase&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;h&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;v&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;angleInDegrees&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;bp&#39;&gt;True&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;6&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;magnitude&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;magnitude&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;h&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;v&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;7&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;8&lt;/span&gt;     &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;orientation&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;magnitude&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now this much shorter and simpler function will also run much faster, thanks to OpenCV. And here&amp;#8217;s how I tested it:&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;python&#39;&gt;&lt;span class=&#39;lineno&#39;&gt;1&lt;/span&gt; &lt;span class=&#39;kn&#39;&gt;import&lt;/span&gt; &lt;span class=&#39;nn&#39;&gt;cProfile&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;2&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;3&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;image&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;imread&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;eye.png&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;4&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;image&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;cvtColor&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;image&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;cv&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;CV_BGR2GRAY&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;5&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;image2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;np&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;copy&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;image&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;6&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;7&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cProfile&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;runctx&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;refGetOrientationAndMagnitude(image)&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;globals&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;nb&#39;&gt;globals&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(),&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;locals&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;nb&#39;&gt;locals&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;())&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;8&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cProfile&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;runctx&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;newGetOrientationAndMagnitude(image)&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;globals&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;nb&#39;&gt;globals&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(),&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;locals&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;nb&#39;&gt;locals&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;())&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Which yielded the following results:&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;text&#39;&gt;201309 function calls in 1.022 seconds

Ordered by: standard name

ncalls  tottime  percall  cumtime  percall filename:lineno(function)
     1    0.000    0.000    1.022    1.022 &amp;lt;string&amp;gt;:1(&amp;lt;module&amp;gt;)
     1    0.823    0.823    1.022    1.022 test.py:7(refGetOrientationAndMagnitude)
     2    0.004    0.002    0.004    0.002 {cv2.Sobel}
201000    0.192    0.000    0.192    0.000 {cv2.fastAtan2}
     1    0.001    0.001    0.001    0.001 {cv2.magnitude}
     1    0.000    0.000    0.000    0.000 {method &amp;#39;disable&amp;#39; of &amp;#39;_lsprof.Profiler&amp;#39; objects}
     2    0.000    0.000    0.000    0.000 {numpy.core.multiarray.empty}
   301    0.002    0.000    0.002    0.000 {range}


7 function calls in 0.004 seconds

Ordered by: standard name

ncalls  tottime  percall  cumtime  percall filename:lineno(function)
    1    0.000    0.000    0.004    0.004 &amp;lt;string&amp;gt;:1(&amp;lt;module&amp;gt;)
    1    0.000    0.000    0.003    0.003 test.py:26(candidateGetOrientationAndMagnitude)
    2    0.002    0.001    0.002    0.001 {cv2.Sobel}
    1    0.000    0.000    0.000    0.000 {cv2.magnitude}
    1    0.001    0.001    0.001    0.001 {cv2.phase}
    1    0.000    0.000    0.000    0.000 {method &amp;#39;disable&amp;#39; of &amp;#39;_lsprof.Profiler&amp;#39; objects}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So 1.022s to 0.004, 255&amp;#215; faster with just replacing a double &lt;code&gt;for&lt;/code&gt; loop with an OpenCV call.&lt;/p&gt;</description>
                <pubDate>Mon, 10 Feb 2014 00:00:00 +0100</pubDate>
                <link>http://mirosval.github.io/master-thesis/2014/02/10/orientation-performance.html</link>
                <guid isPermaLink="true">http://mirosval.github.io/master-thesis/2014/02/10/orientation-performance.html</guid>
            </item>
        
            <item>
                <title>Units Safari Extension</title>
                <description>&lt;p&gt;Did you know that there are still people in this world who use imperial units? For some reason they refuse to switch and continue using this stupid system. I requent Reddit and it&amp;#8217;s quite common to find these people there, so instead of just bitching I decided to do something about it.&lt;/p&gt;

&lt;p&gt;I have made this Safari Extension &lt;a href=&#39;https://github.com/mirosval/Units-Safari-Extension&#39;&gt;Units&lt;/a&gt;, &lt;a href=&#39;https://github.com/mirosval/Units-Safari-Extension/blob/master/units.safariextz?raw=true&#39;&gt;Download&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It takes common expressions as &lt;code&gt;He is 5&amp;#39;4&amp;quot; tall&lt;/code&gt; and translates them to &lt;code&gt;He is 5&amp;#39;4&amp;quot; (162.56 cm) tall&lt;/code&gt;, so now you know that &lt;em&gt;he&lt;/em&gt; is quite short.&lt;/p&gt;

&lt;p&gt;It can also convert some other units, such as miles to km, mpg to km/l and lbs to kg. Of course it does have limitations, for example if somebody writes &lt;code&gt;He is 6 feet tall&lt;/code&gt; or &lt;code&gt;He is 200&lt;/code&gt; it does not get translated, maybe I&amp;#8217;ll add it later, or if somebody wants to contribute, you&amp;#8217;re more than welcome.&lt;/p&gt;

&lt;p&gt;I&amp;#8217;ve switched from Safari back to Chrome recently, so might be I port it there as well, when I get sufficiently annoyed again.&lt;/p&gt;</description>
                <pubDate>Sat, 01 Feb 2014 00:00:00 +0100</pubDate>
                <link>http://mirosval.github.io/other/2014/02/01/safari-units.html</link>
                <guid isPermaLink="true">http://mirosval.github.io/other/2014/02/01/safari-units.html</guid>
            </item>
        
            <item>
                <title>Unwrapping the iris</title>
                <description>&lt;p&gt;In the previous installments we&amp;#8217;ve looked at &lt;a href=&#39;/master-thesis/2014/01/29/pupil-detection.html&#39;&gt;Pupil Detection&lt;/a&gt; and &lt;a href=&#39;/master-thesis/2014/01/30/iris-detection.html&#39;&gt;Iris Detection&lt;/a&gt;. Now we&amp;#8217;ll look at unwrapping the image of the iris from a circular pattern to a rectangular one. We will use this later for some other algorithms.&lt;/p&gt;

&lt;p&gt;So by applying the above mentioned algorithms we got two bits of information: the center of the pupil and the estimated radius of the iris. We can see them on the image below.&lt;/p&gt;

&lt;p&gt;&lt;img alt=&#39;Pupil center and iris radius&#39; src=&#39;http://mirosval.github.io/images/003-unwrap/001-original.png&#39; /&gt;&lt;/p&gt;

&lt;p&gt;In order to transform this circular iris into a rectangular image, we do the following:&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;python&#39;&gt;&lt;span class=&#39;lineno&#39;&gt; 1&lt;/span&gt; &lt;span class=&#39;kn&#39;&gt;import&lt;/span&gt; &lt;span class=&#39;nn&#39;&gt;cv2&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 2&lt;/span&gt; &lt;span class=&#39;kn&#39;&gt;import&lt;/span&gt; &lt;span class=&#39;nn&#39;&gt;numpy&lt;/span&gt; &lt;span class=&#39;kn&#39;&gt;as&lt;/span&gt; &lt;span class=&#39;nn&#39;&gt;np&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 3&lt;/span&gt; &lt;span class=&#39;kn&#39;&gt;import&lt;/span&gt; &lt;span class=&#39;nn&#39;&gt;matplotlib.pyplot&lt;/span&gt; &lt;span class=&#39;kn&#39;&gt;as&lt;/span&gt; &lt;span class=&#39;nn&#39;&gt;plt&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 4&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt; 5&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;image&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;imread&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;003/eye.png&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 6&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt; 7&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;center&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;376&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;184&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 8&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;iris_radius&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;115&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 9&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;10&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;nsamples&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;360&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;11&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;samples&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;np&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;linspace&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;np&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;pi&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;nsamples&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)[:&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;12&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;13&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;polar&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;np&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;zeros&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;((&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;iris_radius&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;nsamples&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;14&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;15&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;r&lt;/span&gt; &lt;span class=&#39;ow&#39;&gt;in&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;range&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;iris_radius&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;):&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;16&lt;/span&gt;     &lt;span class=&#39;k&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;theta&lt;/span&gt; &lt;span class=&#39;ow&#39;&gt;in&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;samples&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;17&lt;/span&gt;         &lt;span class=&#39;n&#39;&gt;x&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;r&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;np&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;cos&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;theta&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;center&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;18&lt;/span&gt;         &lt;span class=&#39;n&#39;&gt;y&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;r&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;np&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;sin&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;theta&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;center&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;19&lt;/span&gt;         
&lt;span class=&#39;lineno&#39;&gt;20&lt;/span&gt;         &lt;span class=&#39;n&#39;&gt;polar&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;r&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;][&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;theta&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;nsamples&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; &lt;span class=&#39;mf&#39;&gt;2.0&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;np&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;pi&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;image&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;y&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;][&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;][&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;21&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;22&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;plt&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;figure&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;figsize&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;10&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;5&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;23&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;plt&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;imshow&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;polar&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cmap&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;gray&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We create an empty image with resolution &lt;code&gt;iris_radius * 360&lt;/code&gt; and then we iterate through this image and calculate the corresponding position in the circular image from the angle and the radius and copy this value to the new image.&lt;/p&gt;

&lt;p&gt;&lt;img alt=&#39;Pupil center and iris radius&#39; src=&#39;http://mirosval.github.io/images/003-unwrap/002-unwrapped.png&#39; /&gt;&lt;/p&gt;

&lt;p&gt;This post is also available as an &lt;a href=&#39;http://nbviewer.ipython.org/gist/mirosval/8754366&#39;&gt;iPython Notebook&lt;/a&gt;&lt;/p&gt;</description>
                <pubDate>Sat, 01 Feb 2014 00:00:00 +0100</pubDate>
                <link>http://mirosval.github.io/master-thesis/2014/02/01/iris-unwrap.html</link>
                <guid isPermaLink="true">http://mirosval.github.io/master-thesis/2014/02/01/iris-unwrap.html</guid>
            </item>
        
            <item>
                <title>Basic Iris Detection</title>
                <description>&lt;p&gt;Iris detection is significantly more difficult than pupil. Mostly because it is not so well defined, pupil is just a black disk essentially as far as a grayscale image is concerned, but the outer edge of the iris is not nearly as sharp as the outer edge of the pupil is. Also, there is a much higher probability of glints and reflections in the iris, since it is larger than the pupil and this can complicate the detection further. And on top of all that the upper and lower eyelids often cover up portions of the iris, which means that detecting the iris as a circle is going to be either difficult or impossible.&lt;/p&gt;

&lt;p&gt;Despite all of these obstacles we have to do it somehow, so for this work, we are going to use the following:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Start off with pupil location&lt;/li&gt;

&lt;li&gt;Smooth down the image using median filter&lt;/li&gt;

&lt;li&gt;Calculate Gradient Image&lt;/li&gt;

&lt;li&gt;Sample lines from the pupil outside&lt;/li&gt;

&lt;li&gt;Vote for the radius with greatest color change&lt;/li&gt;

&lt;li&gt;Draw the iris estimate&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We begin with the location of the pupil as determined by the &lt;a href=&#39;/master-thesis/2014/01/29/pupil-detection.html&#39;&gt;Pupil Detection&lt;/a&gt;. The iris detection technique presented here is relying on the corectness of the pupil detection. It therefore very important for the pupil detection to be correct.&lt;/p&gt;

&lt;p&gt;&lt;img alt=&#39;Pupil detection&#39; src=&#39;http://mirosval.github.io/images/002-iris/001.png&#39; /&gt;&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;python&#39;&gt;&lt;span class=&#39;lineno&#39;&gt; 1&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;def&lt;/span&gt; &lt;span class=&#39;nf&#39;&gt;getOrientationAndMagnitude&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;image&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;show&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;bp&#39;&gt;False&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;):&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 2&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;sobelHorizontal&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;Sobel&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;image&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;CV_32F&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 3&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;sobelVertical&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;Sobel&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;image&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;CV_32F&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 4&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt; 5&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;h&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;sobelHorizontal&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 6&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;v&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;sobelVertical&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 7&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt; 8&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;orientation&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;np&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;empty&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;image&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;shape&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 9&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;magnitude&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;np&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;empty&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;image&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;shape&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;10&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;11&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;height&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;width&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;h&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;shape&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;12&lt;/span&gt;     &lt;span class=&#39;k&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;y&lt;/span&gt; &lt;span class=&#39;ow&#39;&gt;in&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;range&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;height&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;):&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;13&lt;/span&gt;         &lt;span class=&#39;k&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;x&lt;/span&gt; &lt;span class=&#39;ow&#39;&gt;in&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;range&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;width&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;):&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;14&lt;/span&gt;             &lt;span class=&#39;n&#39;&gt;orientation&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;y&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;][&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;fastAtan2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;h&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;y&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;][&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;v&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;y&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;][&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;15&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;16&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;magnitude&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;magnitude&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;h&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;v&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;17&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;18&lt;/span&gt;     &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;orientation&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;magnitude&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img alt=&#39;Orientation&#39; src=&#39;http://mirosval.github.io/images/002-iris/003-orientation.png&#39; /&gt; &lt;img alt=&#39;Magnitude&#39; src=&#39;http://mirosval.github.io/images/002-iris/002-magnitude.png&#39; /&gt;&lt;/p&gt;

&lt;p&gt;We know that the iris is going to be somewhere aroudn the pupil, so to get its radius, we are going to first get a couple of samples (lines that go from the center of the pupil) and then we are going to find the place where the change in intensity is the right orientation and magnitude. To be able to do that, we first need to calculate the orientation and magnitude fields of the image. That is what you can see above.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;python&#39;&gt;&lt;span class=&#39;lineno&#39;&gt; 1&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;def&lt;/span&gt; &lt;span class=&#39;nf&#39;&gt;getCircleSamples&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;center&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;radius&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;nPoints&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;30&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;):&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 2&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;s&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;np&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;linspace&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;np&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;pi&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;nPoints&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)[:&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 3&lt;/span&gt;     &lt;span class=&#39;c&#39;&gt;# print(np.sin(s))&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 4&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt; 5&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;s&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;filter&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;k&#39;&gt;lambda&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;np&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;abs&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;np&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;sin&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#39;mf&#39;&gt;0.7&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;s&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 6&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt; 7&lt;/span&gt;     &lt;span class=&#39;c&#39;&gt;# points&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 8&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;P&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[(&lt;/span&gt;  &lt;span class=&#39;n&#39;&gt;radius&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;np&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;cos&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;t&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;center&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt; 9&lt;/span&gt;             &lt;span class=&#39;n&#39;&gt;radius&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;np&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;sin&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;t&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;center&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;10&lt;/span&gt;             &lt;span class=&#39;n&#39;&gt;np&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;cos&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;t&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;11&lt;/span&gt;             &lt;span class=&#39;n&#39;&gt;np&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;sin&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;t&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;t&lt;/span&gt; &lt;span class=&#39;ow&#39;&gt;in&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;s&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;12&lt;/span&gt;     &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;P&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This function returns a list of tuples, each representing 2 points that delimit a line going from the center of the circle outwards in regular intervals.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;python&#39;&gt;&lt;span class=&#39;lineno&#39;&gt; 1&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;def&lt;/span&gt; &lt;span class=&#39;nf&#39;&gt;getLineCoordinates&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;p1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;p2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;):&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 2&lt;/span&gt;     &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;x1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;y1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;p1&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 3&lt;/span&gt;     &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;x2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;y2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;p2&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 4&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt; 5&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;points&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;[]&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 6&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;issteep&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;abs&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;y2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;y1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;abs&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;x2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;x1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 7&lt;/span&gt;     &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;issteep&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 8&lt;/span&gt;         &lt;span class=&#39;n&#39;&gt;x1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;y1&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;y1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;x1&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 9&lt;/span&gt;         &lt;span class=&#39;n&#39;&gt;x2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;y2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;y2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;x2&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;10&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;rev&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;bp&#39;&gt;False&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;11&lt;/span&gt;     &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;x1&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;x2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;12&lt;/span&gt;         &lt;span class=&#39;n&#39;&gt;x1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;x2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;x2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;x1&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;13&lt;/span&gt;         &lt;span class=&#39;n&#39;&gt;y1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;y2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;y2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;y1&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;14&lt;/span&gt;         &lt;span class=&#39;n&#39;&gt;rev&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;bp&#39;&gt;True&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;15&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;deltax&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;x2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;x1&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;16&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;deltay&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;abs&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;y2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;y1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;17&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;error&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;int&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;deltax&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;18&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;y&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;y1&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;19&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;ystep&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;bp&#39;&gt;None&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;20&lt;/span&gt;     &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;y1&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;y2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;21&lt;/span&gt;         &lt;span class=&#39;n&#39;&gt;ystep&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;22&lt;/span&gt;     &lt;span class=&#39;k&#39;&gt;else&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;23&lt;/span&gt;         &lt;span class=&#39;n&#39;&gt;ystep&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;24&lt;/span&gt;     &lt;span class=&#39;k&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;x&lt;/span&gt; &lt;span class=&#39;ow&#39;&gt;in&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;range&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;x1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;x2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;):&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;25&lt;/span&gt;         &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;issteep&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;26&lt;/span&gt;             &lt;span class=&#39;n&#39;&gt;points&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;append&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;([&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;y&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;27&lt;/span&gt;         &lt;span class=&#39;k&#39;&gt;else&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;28&lt;/span&gt;             &lt;span class=&#39;n&#39;&gt;points&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;append&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;([&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;x&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;y&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;29&lt;/span&gt;         &lt;span class=&#39;n&#39;&gt;error&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;deltay&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;30&lt;/span&gt;         &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;error&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;31&lt;/span&gt;             &lt;span class=&#39;n&#39;&gt;y&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;ystep&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;32&lt;/span&gt;             &lt;span class=&#39;n&#39;&gt;error&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;deltax&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;33&lt;/span&gt;     &lt;span class=&#39;c&#39;&gt;# Reverse the list if the coordinates were reversed&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;34&lt;/span&gt;     &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;rev&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;35&lt;/span&gt;         &lt;span class=&#39;n&#39;&gt;points&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;reverse&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;36&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;37&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;retPoints&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;np&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;array&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;points&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;38&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;39&lt;/span&gt;     &lt;span class=&#39;k&#39;&gt;return&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;retPoints&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This function converts the coordinates of two points into a list of points that lay on the line between the two points. We will evaluate the gradient along this line, and for that we need a list of positions where to look.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;python&#39;&gt;&lt;span class=&#39;lineno&#39;&gt; 1&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;orientation&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;magnitude&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;getOrientationAndMagnitude&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;smooth&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;show&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;bp&#39;&gt;False&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 2&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt; 3&lt;/span&gt; &lt;span class=&#39;c&#39;&gt;# average radius for pupil (since it is an ellipse)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 4&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;pupilRadius&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;pupil_width&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 5&lt;/span&gt; &lt;span class=&#39;c&#39;&gt;# max pupil radius will be at most 5 times pupil radius&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 6&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;irisRadius&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;5&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;pupilRadius&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 7&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt; 8&lt;/span&gt; &lt;span class=&#39;c&#39;&gt;# 30 points laying between pupil and iris&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 9&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;pupilSamples&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;getCircleSamples&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;center&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;min&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;irisRadius&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;mf&#39;&gt;0.5&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;pupilRadius&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;10&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;11&lt;/span&gt; &lt;span class=&#39;c&#39;&gt;# 30 points laying on a circle that is bigger than iris&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;12&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;irisSamples&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;getCircleSamples&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;center&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;irisRadius&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;13&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;14&lt;/span&gt; &lt;span class=&#39;c&#39;&gt;# vote dict for different radii&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;15&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;finalIrisRadiusVotes&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;dict&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;()&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;16&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;17&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;show&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;bp&#39;&gt;True&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;18&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;19&lt;/span&gt; &lt;span class=&#39;c&#39;&gt;# for each sample point in the concentric circle that lies between pupil and iris&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;20&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;sample&lt;/span&gt; &lt;span class=&#39;ow&#39;&gt;in&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;range&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nb&#39;&gt;len&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;pupilSamples&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)):&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;21&lt;/span&gt;     &lt;span class=&#39;c&#39;&gt;# starting point for a line that goes from in between pupil and iris edge&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;22&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;pupilSample&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nb&#39;&gt;int&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;pupilSamples&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;sample&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;][&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]),&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;int&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;pupilSamples&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;sample&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;][&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]))&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;23&lt;/span&gt;     &lt;span class=&#39;c&#39;&gt;# ending point for the line that ends at 5x pupil radius from the pupil center&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;24&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;irisSample&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nb&#39;&gt;int&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;irisSamples&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;sample&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;][&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]),&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;int&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;irisSamples&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;sample&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;][&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]))&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;25&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;26&lt;/span&gt;     &lt;span class=&#39;c&#39;&gt;# line defined by pupilSample and irisSample points has the direction of&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;27&lt;/span&gt;     &lt;span class=&#39;c&#39;&gt;# the normal for the iris circle&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;28&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;29&lt;/span&gt;     &lt;span class=&#39;c&#39;&gt;# points in the image that lay on the line&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;30&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;lineCoordinates&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;getLineCoordinates&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;pupilSample&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;irisSample&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;31&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;32&lt;/span&gt;     &lt;span class=&#39;c&#39;&gt;# normal vector for the pupil/iris circles&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;33&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;sampleVector&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;pupilSample&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;center&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;pupilSample&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;center&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;34&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;35&lt;/span&gt;     &lt;span class=&#39;c&#39;&gt;# length of the normal vector&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;36&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;dist&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;np&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;sqrt&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;sampleVector&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;**&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;sampleVector&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;**&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;37&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;38&lt;/span&gt;     &lt;span class=&#39;c&#39;&gt;# angle of the normal vector&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;39&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;angle&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;fastAtan2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;sampleVector&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;sampleVector&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;40&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;41&lt;/span&gt;     &lt;span class=&#39;c&#39;&gt;# loop over all the points on the line&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;42&lt;/span&gt;     &lt;span class=&#39;k&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;s&lt;/span&gt; &lt;span class=&#39;ow&#39;&gt;in&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;lineCoordinates&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;43&lt;/span&gt;         &lt;span class=&#39;c&#39;&gt;# sometimes the line is outside the magnitude arrays, in that case just conitnue the loop&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;44&lt;/span&gt;         &lt;span class=&#39;k&#39;&gt;try&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;45&lt;/span&gt;             &lt;span class=&#39;n&#39;&gt;mag&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;magnitude&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;s&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;][&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;s&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;46&lt;/span&gt;         &lt;span class=&#39;k&#39;&gt;except&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;47&lt;/span&gt;             &lt;span class=&#39;k&#39;&gt;continue&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;48&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;49&lt;/span&gt;         &lt;span class=&#39;c&#39;&gt;# only consider those points that have magnitude greater than 15 but lower than 30&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;50&lt;/span&gt;         &lt;span class=&#39;c&#39;&gt;# since the gradient is a slow one&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;51&lt;/span&gt;         &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;mag&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;15&lt;/span&gt; &lt;span class=&#39;ow&#39;&gt;and&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;mag&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;30&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;52&lt;/span&gt;             &lt;span class=&#39;c&#39;&gt;# orientation at the point in question&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;53&lt;/span&gt;             &lt;span class=&#39;n&#39;&gt;ori&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;orientation&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;s&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;][&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;s&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;54&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;55&lt;/span&gt;             &lt;span class=&#39;c&#39;&gt;# cleanup the angle so that it is a comparable number to the angle of the line we&amp;#39;ve&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;56&lt;/span&gt;             &lt;span class=&#39;c&#39;&gt;# obtained earlier&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;57&lt;/span&gt;             &lt;span class=&#39;n&#39;&gt;an&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;angle&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;ori&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;mf&#39;&gt;90.0&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;58&lt;/span&gt;             &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;an&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#39;mf&#39;&gt;360.0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;an&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-=&lt;/span&gt; &lt;span class=&#39;mf&#39;&gt;360.0&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;59&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;60&lt;/span&gt;             &lt;span class=&#39;c&#39;&gt;# angle difference should be +-3 degrees&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;61&lt;/span&gt;             &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;an&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;3&lt;/span&gt; &lt;span class=&#39;ow&#39;&gt;or&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;an&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;357&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;62&lt;/span&gt;                 &lt;span class=&#39;c&#39;&gt;# we have a good sample point with the right magnitude and orientation&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;63&lt;/span&gt;                 &lt;span class=&#39;c&#39;&gt;# calculate the radius of the iris this would correspond to&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;64&lt;/span&gt;                 &lt;span class=&#39;n&#39;&gt;radius&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;np&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;sqrt&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;((&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;s&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;center&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;**&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;s&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;center&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;**&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;65&lt;/span&gt;                 &lt;span class=&#39;c&#39;&gt;# Round radius to tens&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;66&lt;/span&gt;                 &lt;span class=&#39;n&#39;&gt;radius&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;round&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;radius&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; &lt;span class=&#39;mf&#39;&gt;10.0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;mf&#39;&gt;10.0&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;67&lt;/span&gt;                 &lt;span class=&#39;n&#39;&gt;radius&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;int&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;radius&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;68&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;69&lt;/span&gt;                 &lt;span class=&#39;c&#39;&gt;# draw the sample that we have used&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;70&lt;/span&gt;                 &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;show&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;71&lt;/span&gt;                     &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;circle&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;image&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;s&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;],&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;s&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]),&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;255&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;255&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;72&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;73&lt;/span&gt;                 &lt;span class=&#39;c&#39;&gt;# add the radius to the vote dict&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;74&lt;/span&gt;                 &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;radius&lt;/span&gt; &lt;span class=&#39;ow&#39;&gt;not&lt;/span&gt; &lt;span class=&#39;ow&#39;&gt;in&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;finalIrisRadiusVotes&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;75&lt;/span&gt;                     &lt;span class=&#39;n&#39;&gt;finalIrisRadiusVotes&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;radius&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;76&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;77&lt;/span&gt;                 &lt;span class=&#39;n&#39;&gt;finalIrisRadiusVotes&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;radius&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;+=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;78&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;79&lt;/span&gt;     &lt;span class=&#39;c&#39;&gt;# draw the line&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;80&lt;/span&gt;     &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;show&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;81&lt;/span&gt;         &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;line&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;image&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;pupilSample&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;irisSample&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;255&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;82&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;83&lt;/span&gt; &lt;span class=&#39;c&#39;&gt;# order the radius dict by votes and grab the winner&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;84&lt;/span&gt; &lt;span class=&#39;kn&#39;&gt;import&lt;/span&gt; &lt;span class=&#39;nn&#39;&gt;operator&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;85&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;finalIrisRadius&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;max&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;finalIrisRadiusVotes&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;iteritems&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(),&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;key&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;operator&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;itemgetter&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;86&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;87&lt;/span&gt; &lt;span class=&#39;c&#39;&gt;# draw the winning radius&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;88&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;circle&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;image&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;center&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;finalIrisRadius&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;255&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;255&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;89&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;imshow&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;quot;Test&amp;quot;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;image&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now to put it all together, we start with orientation and magnitude maps. Then sample the original image to get lines from the pupil out. We loop through these samples and find places where the gradient magnitude and orientation is just right and then add a vote for the radius at that location. In the end we just grab the radius with the most votes and draw an ellipse around it. In the image below, the purple circle is the estimated iris radius, the aqua circles are votes and the green lines are samples. You can see that the lines don&amp;#8217;t cover the whole circle. That is because it is probable that eyelids will cover top and bottom portion of the iris and therefore interfere with the algorithm, so we only consider the horizontal samples, as defined by &lt;code&gt;sin(x) &amp;lt; 0.7&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img alt=&#39;Final image iris radius estimation&#39; src=&#39;http://mirosval.github.io/images/002-iris/004-final.png&#39; /&gt;&lt;/p&gt;

&lt;p&gt;This is it for the iris detection, next time we&amp;#8217;ll look at unwrapping the iris to form a rectangular image.&lt;/p&gt;

&lt;p&gt;This post is also available as an &lt;a href=&#39;http://nbviewer.ipython.org/gist/mirosval/8752437&#39;&gt;iPython Notebook&lt;/a&gt;&lt;/p&gt;</description>
                <pubDate>Thu, 30 Jan 2014 00:00:00 +0100</pubDate>
                <link>http://mirosval.github.io/master-thesis/2014/01/30/iris-detection.html</link>
                <guid isPermaLink="true">http://mirosval.github.io/master-thesis/2014/01/30/iris-detection.html</guid>
            </item>
        
            <item>
                <title>Basic Pupil Detection</title>
                <description>&lt;p&gt;Pupil Detection will be the basis of my eye tracker. In the end it will rely on accurate and robust pupil detection, but for now a simple detector will do. Later I will revisit the detection when the basics of the other components are done.&lt;/p&gt;

&lt;p&gt;The idea presented here is a simple one. If we look at the image, the pupil is just a black circle. Now this might not always be true, as in the circle does not always have to be completely black (in case we have some glints) and might not be a circle (if we&amp;#8217;re looking at the pupil under an angle). We will deal with these potential issues later, for now we&amp;#8217;ll just stick to the basics.&lt;/p&gt;

&lt;p&gt;I will be using &lt;a href=&#39;http://opencv.org/&#39;&gt;OpenCV 2&lt;/a&gt; and &lt;a href=&#39;http://www.python.org/&#39;&gt;Python 2.7.5&lt;/a&gt; on OSX.&lt;/p&gt;

&lt;p&gt;So on a high level, the process is the following:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Load the image and convert it to grayscale&lt;/li&gt;

&lt;li&gt;Threshold the image&lt;/li&gt;

&lt;li&gt;Cleanup using closing&lt;/li&gt;

&lt;li&gt;Find the most circular contour&lt;/li&gt;

&lt;li&gt;Draw it into the original image&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;So here I just load the original image.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;python&#39;&gt;&lt;span class=&#39;lineno&#39;&gt;1&lt;/span&gt; &lt;span class=&#39;kn&#39;&gt;import&lt;/span&gt; &lt;span class=&#39;nn&#39;&gt;cv2&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;2&lt;/span&gt; &lt;span class=&#39;kn&#39;&gt;import&lt;/span&gt; &lt;span class=&#39;nn&#39;&gt;numpy&lt;/span&gt; &lt;span class=&#39;kn&#39;&gt;as&lt;/span&gt; &lt;span class=&#39;nn&#39;&gt;np&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;3&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;4&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;image&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;imread&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;eye.png&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;5&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;gray&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;cvtColor&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;image&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;cv&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;CV_BGR2GRAY&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img alt=&#39;Eye image&#39; src=&#39;http://mirosval.github.io/images/001-pupil/001.png&#39; /&gt;&lt;/p&gt;

&lt;p&gt;Now that that&amp;#8217;s out of the way, I&amp;#8217;ll threshold it. This will make a binary image out of a grayscale one. So everything darker than 30 goes to black, and everything else goes to white. And this is what I get.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;python&#39;&gt;&lt;span class=&#39;lineno&#39;&gt;1&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;retval&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;thresholded&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;threshold&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;gray&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;30&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;255&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;cv&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;CV_THRESH_BINARY&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img alt=&#39;Threshold image&#39; src=&#39;http://mirosval.github.io/images/001-pupil/002.png&#39; /&gt;&lt;/p&gt;

&lt;p&gt;Now this next part (Line 1 and 2) does not have to be here for this particular image, but in general it should be there, becuase you want to get rid of small holes that might occur in the pupil from glints, but since there are none in this image, it is of no concern.&lt;/p&gt;

&lt;p&gt;Now the binary image is fed into the &lt;a href=&#39;http://docs.opencv.org/modules/imgproc/doc/structural_analysis_and_shape_descriptors.html?#findcontours&#39;&gt;findContours&lt;/a&gt; function, which will identify individual &amp;#8220;objects&amp;#8221; in the image. In this case we get two, one is for the pupil and one is for the whole image. So how to distinguish between the two? I used the &lt;code&gt;extend&lt;/code&gt; parameter which puts in relation the area of a shape to the area of its bounding box. This will be close to 1 for the whole image, because it is rectangular, but lower for the pupil, since it is more circular. Something like &lt;a href=&#39;http://docs.opencv.org/modules/imgproc/doc/structural_analysis_and_shape_descriptors.html?#convexhull&#39;&gt;Convex Hull&lt;/a&gt; and &lt;a href=&#39;http://docs.opencv.org/modules/imgproc/doc/structural_analysis_and_shape_descriptors.html?#arclength&#39;&gt;Arc Length&lt;/a&gt; could be used to make this more robust. For example use the ratio of the radius to area. I will revisit this topic in the future.&lt;/p&gt;

&lt;p&gt;At last we compute the center of the detected area and fit an ellipse around it, so that we can draw the results into the last image.&lt;/p&gt;
&lt;div class=&#39;highlight&#39;&gt;&lt;pre&gt;&lt;code class=&#39;python&#39;&gt;&lt;span class=&#39;lineno&#39;&gt; 1&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;kernel&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;getStructuringElement&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;MORPH_RECT&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;10&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;10&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 2&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;closed&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;erode&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;dilate&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;thresholded&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;kernel&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;iterations&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;kernel&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;iterations&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 3&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt; 4&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;contours&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;hierarchy&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;findContours&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;closed&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;cv&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;CV_RETR_LIST&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;cv&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;CV_CHAIN_APPROX_NONE&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 5&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt; 6&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;drawing&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;np&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;copy&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;image&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 7&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt; 8&lt;/span&gt; &lt;span class=&#39;k&#39;&gt;for&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;contour&lt;/span&gt; &lt;span class=&#39;ow&#39;&gt;in&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;contours&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt; 9&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;area&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;contourArea&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;contour&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;10&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;bounding_box&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;boundingRect&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;contour&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;11&lt;/span&gt;     
&lt;span class=&#39;lineno&#39;&gt;12&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;extend&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;area&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;bounding_box&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;2&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;*&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;bounding_box&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;])&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;13&lt;/span&gt;     
&lt;span class=&#39;lineno&#39;&gt;14&lt;/span&gt;     &lt;span class=&#39;c&#39;&gt;# reject the contours with big extend&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;15&lt;/span&gt;     &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;extend&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#39;mf&#39;&gt;0.8&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;16&lt;/span&gt;         &lt;span class=&#39;k&#39;&gt;continue&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;17&lt;/span&gt;     
&lt;span class=&#39;lineno&#39;&gt;18&lt;/span&gt;     &lt;span class=&#39;c&#39;&gt;# calculate countour center and draw a dot there&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;19&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;m&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;moments&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;contour&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;20&lt;/span&gt;     &lt;span class=&#39;k&#39;&gt;if&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;m&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;m00&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;!=&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;:&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;21&lt;/span&gt;         &lt;span class=&#39;n&#39;&gt;center&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;nb&#39;&gt;int&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;m&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;m10&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;m&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;m00&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]),&lt;/span&gt; &lt;span class=&#39;nb&#39;&gt;int&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;m&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;m01&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;/&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;m&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;[&lt;/span&gt;&lt;span class=&#39;s&#39;&gt;&amp;#39;m00&amp;#39;&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;]))&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;22&lt;/span&gt;         &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;circle&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;drawing&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;center&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;3&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;255&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;),&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;-&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;1&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;23&lt;/span&gt;     
&lt;span class=&#39;lineno&#39;&gt;24&lt;/span&gt;     &lt;span class=&#39;c&#39;&gt;# fit an ellipse around the contour and draw it into the image&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;25&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;ellipse&lt;/span&gt; &lt;span class=&#39;o&#39;&gt;=&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;fitEllipse&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;contour&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;26&lt;/span&gt;     &lt;span class=&#39;n&#39;&gt;cv2&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;ellipse&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;drawing&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;box&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;ellipse&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;color&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;255&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;0&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;27&lt;/span&gt; 
&lt;span class=&#39;lineno&#39;&gt;28&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;plt&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;figure&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;figsize&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;=&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;mi&#39;&gt;10&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;,&lt;/span&gt; &lt;span class=&#39;mi&#39;&gt;5&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;))&lt;/span&gt;
&lt;span class=&#39;lineno&#39;&gt;29&lt;/span&gt; &lt;span class=&#39;n&#39;&gt;plt&lt;/span&gt;&lt;span class=&#39;o&#39;&gt;.&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;imshow&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;(&lt;/span&gt;&lt;span class=&#39;n&#39;&gt;drawing&lt;/span&gt;&lt;span class=&#39;p&#39;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img alt=&#39;Final image&#39; src=&#39;http://mirosval.github.io/images/001-pupil/003.png&#39; /&gt;&lt;/p&gt;

&lt;p&gt;So that is how we quickly detect the position of a pupil in an image. In the next installments we will look at how to detect the iris, which is a bit more complicated. We will also flatten the iris out and then we will look at processing video.&lt;/p&gt;

&lt;p&gt;This post is also available as a &lt;a href=&#39;http://nbviewer.ipython.org/gist/mirosval/8752402&#39;&gt;iPython Notebook&lt;/a&gt;&lt;/p&gt;</description>
                <pubDate>Wed, 29 Jan 2014 00:00:00 +0100</pubDate>
                <link>http://mirosval.github.io/master-thesis/2014/01/29/pupil-detection.html</link>
                <guid isPermaLink="true">http://mirosval.github.io/master-thesis/2014/01/29/pupil-detection.html</guid>
            </item>
        
            <item>
                <title>Intro</title>
                <description>&lt;p&gt;Hi everyone, I intend to use this blog thing to write about the progress of my Master Thesis. I&amp;#8217;ll be talking about implementing various computer vision algorithms together to form an eye-tracker. In between I&amp;#8217;ll talk about other things if something interesting comes up.&lt;/p&gt;</description>
                <pubDate>Tue, 28 Jan 2014 00:00:00 +0100</pubDate>
                <link>http://mirosval.github.io/2014/01/28/intro.html</link>
                <guid isPermaLink="true">http://mirosval.github.io/2014/01/28/intro.html</guid>
            </item>
        
    </channel>
</rss>
